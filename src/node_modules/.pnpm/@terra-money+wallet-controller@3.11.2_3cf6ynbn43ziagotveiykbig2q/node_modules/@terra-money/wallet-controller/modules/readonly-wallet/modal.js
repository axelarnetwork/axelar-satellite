import { AccAddress } from '@terra-money/terra.js';
import { modalStyle } from './modal.style';
export function readonlyWalletModal({ networks, }) {
    return new Promise((resolve) => {
        var _a, _b;
        const styleContainer = document.createElement('style');
        const modalContainer = document.createElement('div');
        function onComplete(session) {
            var _a, _b;
            resolve(session);
            (_a = styleContainer.parentElement) === null || _a === void 0 ? void 0 : _a.removeChild(styleContainer);
            (_b = modalContainer.parentElement) === null || _b === void 0 ? void 0 : _b.removeChild(modalContainer);
        }
        const element = createModalElement({
            networks,
            onComplete,
        });
        styleContainer.textContent = modalStyle;
        modalContainer.appendChild(element);
        (_a = document.querySelector('head')) === null || _a === void 0 ? void 0 : _a.appendChild(styleContainer);
        (_b = document.querySelector('body')) === null || _b === void 0 ? void 0 : _b.appendChild(modalContainer);
    });
}
function createModalElement({ networks, onComplete, }) {
    let chainID = networks[0].chainID;
    let address = '';
    // ---------------------------------------------
    // container
    // ---------------------------------------------
    const container = document.createElement('div');
    container.setAttribute('class', 'wallet-readonly-modal');
    // ---------------------------------------------
    // container > div.wallet-readonly-modal--dim
    // ---------------------------------------------
    const dim = document.createElement('div');
    dim.setAttribute('class', 'wallet-readonly-modal--dim');
    container.appendChild(dim);
    // ---------------------------------------------
    // content > div.wallet-readonly-modal--content
    // ---------------------------------------------
    const content = document.createElement('section');
    content.setAttribute('class', 'wallet-readonly-modal--content');
    container.appendChild(content);
    // h1
    const title = document.createElement('h1');
    title.textContent = 'View an Address';
    content.appendChild(title);
    // div
    const selectContainer = document.createElement('div');
    content.appendChild(selectContainer);
    // div > label
    const selectLabel = document.createElement('label');
    selectLabel.textContent = 'Network';
    selectContainer.appendChild(selectLabel);
    // div > .select-wrapper
    const selectWrapper = document.createElement('div');
    selectWrapper.setAttribute('class', 'select-wrapper');
    selectContainer.appendChild(selectWrapper);
    // div > .select-wrapper > select
    const select = document.createElement('select');
    for (const itemNetwork of networks) {
        const option = document.createElement('option');
        option.setAttribute('value', itemNetwork.chainID);
        if (chainID === itemNetwork.chainID) {
            option.setAttribute('selected', '');
        }
        option.textContent = `${itemNetwork.name[0].toUpperCase()}${itemNetwork.name.slice(1)} - ${itemNetwork.chainID}`;
        select.appendChild(option);
    }
    selectWrapper.appendChild(select);
    // div > .select-wrapper > svg
    const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
    svg.setAttribute('viewbox', '0 0 24 24');
    const arrow = document.createElementNS('http://www.w3.org/2000/svg', 'path');
    arrow.setAttribute('d', 'M7 10l5 5 5-5z');
    svg.appendChild(arrow);
    selectWrapper.appendChild(svg);
    // div
    const inputContainer = document.createElement('div');
    content.appendChild(inputContainer);
    // div > label
    const inputLabel = document.createElement('label');
    inputLabel.textContent = 'Address';
    inputContainer.appendChild(inputLabel);
    // div > input
    const input = document.createElement('input');
    input.setAttribute('type', 'text');
    inputContainer.appendChild(input);
    // button
    const button = document.createElement('button');
    button.disabled = true;
    button.textContent = 'View an Address';
    content.appendChild(button);
    // ---------------------------------------------
    // bind data
    // ---------------------------------------------
    dim.addEventListener('click', () => {
        onComplete(null);
    });
    select.addEventListener('change', (event) => {
        chainID = event.target.value;
    });
    input.addEventListener('input', (event) => {
        address = event.target.value;
        button.disabled = !(AccAddress.validate(address) && button.hasAttribute('disabled'));
    });
    button.addEventListener('click', () => {
        const network = networks.find((itemNetwork) => itemNetwork.chainID === chainID);
        if (!network) {
            return;
        }
        onComplete({
            network,
            terraAddress: address,
        });
    });
    return container;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9kYWwuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9zcmMvQHRlcnJhLW1vbmV5L3dhbGxldC1jb250cm9sbGVyL21vZHVsZXMvcmVhZG9ubHktd2FsbGV0L21vZGFsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUNuRCxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBTzNDLE1BQU0sVUFBVSxtQkFBbUIsQ0FBQyxFQUNsQyxRQUFRLEdBQ0E7SUFDUixPQUFPLElBQUksT0FBTyxDQUErQixDQUFDLE9BQU8sRUFBRSxFQUFFOztRQUMzRCxNQUFNLGNBQWMsR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ3ZELE1BQU0sY0FBYyxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUM7UUFFckQsU0FBUyxVQUFVLENBQUMsT0FBcUM7O1lBQ3ZELE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUNqQixNQUFBLGNBQWMsQ0FBQyxhQUFhLDBDQUFFLFdBQVcsQ0FBQyxjQUFjLENBQUMsQ0FBQztZQUMxRCxNQUFBLGNBQWMsQ0FBQyxhQUFhLDBDQUFFLFdBQVcsQ0FBQyxjQUFjLENBQUMsQ0FBQztRQUM1RCxDQUFDO1FBRUQsTUFBTSxPQUFPLEdBQUcsa0JBQWtCLENBQUM7WUFDakMsUUFBUTtZQUNSLFVBQVU7U0FDWCxDQUFDLENBQUM7UUFFSCxjQUFjLENBQUMsV0FBVyxHQUFHLFVBQVUsQ0FBQztRQUN4QyxjQUFjLENBQUMsV0FBVyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBRXBDLE1BQUEsUUFBUSxDQUFDLGFBQWEsQ0FBQyxNQUFNLENBQUMsMENBQUUsV0FBVyxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBQzVELE1BQUEsUUFBUSxDQUFDLGFBQWEsQ0FBQyxNQUFNLENBQUMsMENBQUUs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ICdAdGVycmEtbW9uZXkvd2FsbGV0LXR5cGVzJztcbmltcG9ydCB7IEFjY0FkZHJlc3MgfSBmcm9tICdAdGVycmEtbW9uZXkvdGVycmEuanMnO1xuaW1wb3J0IHsgbW9kYWxTdHlsZSB9IGZyb20gJy4vbW9kYWwuc3R5bGUnO1xuaW1wb3J0IHsgUmVhZG9ubHlXYWxsZXRTZXNzaW9uIH0gZnJvbSAnLi90eXBlcyc7XG5cbmludGVyZmFjZSBPcHRpb25zIHtcbiAgbmV0d29ya3M6IE5ldHdvcmtJbmZvW107XG59XG5cbmV4cG9ydCBmdW5jdGlvbiByZWFkb25seVdhbGxldE1vZGFsKHtcbiAgbmV0d29ya3MsXG59OiBPcHRpb25zKTogUHJvbWlzZTxSZWFkb25seVdhbGxldFNlc3Npb24gfCBudWxsPiB7XG4gIHJldHVybiBuZXcgUHJvbWlzZTxSZWFkb25seVdhbGxldFNlc3Npb24gfCBudWxsPigocmVzb2x2ZSkgPT4ge1xuICAgIGNvbnN0IHN0eWxlQ29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3R5bGUnKTtcbiAgICBjb25zdCBtb2RhbENvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuXG4gICAgZnVuY3Rpb24gb25Db21wbGV0ZShzZXNzaW9uOiBSZWFkb25seVdhbGxldFNlc3Npb24gfCBudWxsKSB7XG4gICAgICByZXNvbHZlKHNlc3Npb24pO1xuICAgICAgc3R5bGVDb250YWluZXIucGFyZW50RWxlbWVudD8ucmVtb3ZlQ2hpbGQoc3R5bGVDb250YWluZXIpO1xuICAgICAgbW9kYWxDb250YWluZXIucGFyZW50RWxlbWVudD8ucmVtb3ZlQ2hpbGQobW9kYWxDb250YWluZXIpO1xuICAgIH1cblxuICAgIGNvbnN0IGVsZW1lbnQgPSBjcmVhdGVNb2RhbEVsZW1lbnQoe1xuICAgICAgbmV0d29ya3MsXG4gICAgICBvbkNvbXBsZXRlLFxuICAgIH0pO1xuXG4gICAgc3R5bGVDb250YWluZXIudGV4dENvbnRlbnQgPSBtb2RhbFN0eWxlO1xuICAgIG1vZGFsQ29udGFpbmVyLmFwcGVuZENoaWxkKGVsZW1lbnQpO1xuXG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignaGVhZCcpPy5hcHBlbmRDaGlsZChzdHlsZUNvbnRhaW5lcik7XG4gICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignYm9keScpPy5hcHBlbmRDaGlsZChtb2RhbENvbnRhaW5lcik7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVNb2RhbEVsZW1lbnQoe1xuICBuZXR3b3JrcyxcbiAgb25Db21wbGV0ZSxcbn06IE9wdGlvbnMgJiB7XG4gIG9uQ29tcGxldGU6IChzZXNzaW9uOiBSZWFkb25seVdhbGxldFNlc3Npb24gfCBudWxsKSA9PiB2b2lkO1xufSk6IEhUTUxFbGVtZW50IHtcbiAgbGV0IGNoYWluSUQ6IHN0cmluZyA9IG5ldHdvcmtzWzBdLmNoYWluSUQ7XG4gIGxldCBhZGRyZXNzOiBzdHJpbmcgPSAnJztcblxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gY29udGFpbmVyXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgY29udGFpbmVyLnNldEF0dHJpYnV0ZSgnY2xhc3MnLCAnd2FsbGV0LXJlYWRvbmx5LW1vZGFsJyk7XG5cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIGNvbnRhaW5lciA+IGRpdi53YWxsZXQtcmVhZG9ubHktbW9kYWwtLWRpbVxuICAvLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgY29uc3QgZGltID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gIGRpbS5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgJ3dhbGxldC1yZWFkb25seS1tb2RhbC0tZGltJyk7XG5cbiAgY29udGFpbmVyLmFwcGVuZENoaWxkKGRpbSk7XG5cbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIGNvbnRlbnQgPiBkaXYud2FsbGV0LXJlYWRvbmx5LW1vZGFsLS1jb250ZW50XG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICBjb25zdCBjb250ZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2VjdGlvbicpO1xuICBjb250ZW50LnNldEF0dHJpYnV0ZSgnY2xhc3MnLCAnd2FsbGV0LXJlYWRvbmx5LW1vZGFsLS1jb250ZW50Jyk7XG5cbiAgY29udGFpbmVyLmFwcGVuZENoaWxkKGNvbnRlbnQpO1xuXG4gIC8vIGgxXG4gIGNvbnN0IHRpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaDEnKTtcbiAgdGl0bGUudGV4dENvbnRlbnQgPSAnVmlldyBhbiBBZGRyZXNzJztcbiAgY29udGVudC5hcHBlbmRDaGlsZCh0aXRsZSk7XG5cbiAgLy8gZGl2XG4gIGNvbnN0IHNlbGVjdENvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICBjb250ZW50LmFwcGVuZENoaWxkKHNlbGVjdENvbnRhaW5lcik7XG5cbiAgLy8gZGl2ID4gbGFiZWxcbiAgY29uc3Qgc2VsZWN0TGFiZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsYWJlbCcpO1xuICBzZWxlY3RMYWJlbC50ZXh0Q29udGVudCA9ICdOZXR3b3JrJztcbiAgc2VsZWN0Q29udGFpbmVyLmFwcGVuZENoaWxkKHNlbGVjdExhYmVsKTtcblxuICAvLyBkaXYgPiAuc2VsZWN0LXdyYXBwZXJcbiAgY29uc3Qgc2VsZWN0V3JhcHBlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICBzZWxlY3RXcmFwcGVyLnNldEF0dHJpYnV0ZSgnY2xhc3MnLCAnc2VsZWN0LXdyYXBwZXInKTtcbiAgc2VsZWN0Q29udGFpbmVyLmFwcGVuZENoaWxkKHNlbGVjdFdyYXBwZXIpO1xuXG4gIC8vIGRpdiA+IC5zZWxlY3Qtd3JhcHBlciA+IHNlbGVjdFxuICBjb25zdCBzZWxlY3QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzZWxlY3QnKTtcblxuICBmb3IgKGNvbnN0IGl0ZW1OZXR3b3JrIG9mIG5ldHdvcmtzKSB7XG4gICAgY29uc3Qgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7XG4gICAgb3B0aW9uLnNldEF0dHJpYnV0ZSgndmFsdWUnLCBpdGVtTmV0d29yay5jaGFpbklEKTtcblxuICAgIGlmIChjaGFpbklEID09PSBpdGVtTmV0d29yay5jaGFpbklEKSB7XG4gICAgICBvcHRpb24uc2V0QXR0cmlidXRlKCdzZWxlY3RlZCcsICcnKTtcbiAgICB9XG5cbiAgICBvcHRpb24udGV4dENvbnRlbnQgPSBgJHtpdGVtTmV0d29yay5uYW1lWzBdLnRvVXBwZXJDYXNlKCl9JHtpdGVtTmV0d29yay5uYW1lLnNsaWNlKFxuICAgICAgMSxcbiAgICApfSAtICR7aXRlbU5ldHdvcmsuY2hhaW5JRH1gO1xuXG4gICAgc2VsZWN0LmFwcGVuZENoaWxkKG9wdGlvbik7XG4gIH1cblxuICBzZWxlY3RXcmFwcGVyLmFwcGVuZENoaWxkKHNlbGVjdCk7XG5cbiAgLy8gZGl2ID4gLnNlbGVjdC13cmFwcGVyID4gc3ZnXG4gIGNvbnN0IHN2ZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLCAnc3ZnJyk7XG4gIHN2Zy5zZXRBdHRyaWJ1dGUoJ3ZpZXdib3gnLCAnMCAwIDI0IDI0Jyk7XG5cbiAgY29uc3QgYXJyb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoJ2h0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnJywgJ3BhdGgnKTtcbiAgYXJyb3cuc2V0QXR0cmlidXRlKCdkJywgJ003IDEwbDUgNSA1LTV6Jyk7XG4gIHN2Zy5hcHBlbmRDaGlsZChhcnJvdyk7XG5cbiAgc2VsZWN0V3JhcHBlci5hcHBlbmRDaGlsZChzdmcpO1xuXG4gIC8vIGRpdlxuICBjb25zdCBpbnB1dENvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICBjb250ZW50LmFwcGVuZENoaWxkKGlucHV0Q29udGFpbmVyKTtcblxuICAvLyBkaXYgPiBsYWJlbFxuICBjb25zdCBpbnB1dExhYmVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGFiZWwnKTtcbiAgaW5wdXRMYWJlbC50ZXh0Q29udGVudCA9ICdBZGRyZXNzJztcblxuICBpbnB1dENvbnRhaW5lci5hcHBlbmRDaGlsZChpbnB1dExhYmVsKTtcblxuICAvLyBkaXYgPiBpbnB1dFxuICBjb25zdCBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7XG4gIGlucHV0LnNldEF0dHJpYnV0ZSgndHlwZScsICd0ZXh0Jyk7XG5cbiAgaW5wdXRDb250YWluZXIuYXBwZW5kQ2hpbGQoaW5wdXQpO1xuXG4gIC8vIGJ1dHRvblxuICBjb25zdCBidXR0b24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTtcbiAgYnV0dG9uLmRpc2FibGVkID0gdHJ1ZTtcbiAgYnV0dG9uLnRleHRDb250ZW50ID0gJ1ZpZXcgYW4gQWRkcmVzcyc7XG5cbiAgY29udGVudC5hcHBlbmRDaGlsZChidXR0b24pO1xuXG4gIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICAvLyBiaW5kIGRhdGFcbiAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIGRpbS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICBvbkNvbXBsZXRlKG51bGwpO1xuICB9KTtcblxuICBzZWxlY3QuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgKGV2ZW50KSA9PiB7XG4gICAgY2hhaW5JRCA9IChldmVudC50YXJnZXQgYXMgSFRNTFNlbGVjdEVsZW1lbnQpLnZhbHVlO1xuICB9KTtcblxuICBpbnB1dC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIChldmVudCkgPT4ge1xuICAgIGFkZHJlc3MgPSAoZXZlbnQudGFyZ2V0IGFzIEhUTUxJbnB1dEVsZW1lbnQpLnZhbHVlO1xuXG4gICAgYnV0dG9uLmRpc2FibGVkID0gIShcbiAgICAgIEFjY0FkZHJlc3MudmFsaWRhdGUoYWRkcmVzcykgJiYgYnV0dG9uLmhhc0F0dHJpYnV0ZSgnZGlzYWJsZWQnKVxuICAgICk7XG4gIH0pO1xuXG4gIGJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgICBjb25zdCBuZXR3b3JrID0gbmV0d29ya3MuZmluZChcbiAgICAgIChpdGVtTmV0d29yaykgPT4gaXRlbU5ldHdvcmsuY2hhaW5JRCA9PT0gY2hhaW5JRCxcbiAgICApO1xuXG4gICAgaWYgKCFuZXR3b3JrKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgb25Db21wbGV0ZSh7XG4gICAgICBuZXR3b3JrLFxuICAgICAgdGVycmFBZGRyZXNzOiBhZGRyZXNzLFxuICAgIH0pO1xuICB9KTtcblxuICByZXR1cm4gY29udGFpbmVyO1xufVxuIl19